## OpenBMC DBus on QEMU å¯¦é©—ç´€éŒ„

ğŸ¯ ç›®æ¨™
  åœ¨ QEMU ä¸Šå•Ÿå‹• OpenBMCï¼Œä¸¦é€é busctl å†ç‹€æ…‹æœå‹™ä¸­ æŸ¥è©¢ã€ç›£è½èˆ‡æ“ä½œç³»çµ±

ğŸŒ¸ ç’°å¢ƒ
  Host: Ubuntu 20.04 / WSL2
  QEMU target: qemuarm
  Image: obmc-phosphor-image
  Networking: slirp (host port forwarding)
  Tool: busctl, obmcutil, ssh

ğŸ”‘ æ­¥é©Ÿ
1. SSH é€²å…¥ Guest(BMC)
  ssh -N -L 2443:127.0.0.1:443   // -N ä¸åŸ·è¡Œé ç«¯ -L [local_poart]:[remote_host]:[remote_port]
  ssh -p 2222 root@127.0.0.1     // -p 2222 SSH é€£æ¥åŸ ï¼ˆæ¨¡æ“¬æˆ–å¯¦é«” BMC çš„ SSH portï¼‰
  cat /etc/os-release   # ç¢ºèªæ˜¯åœ¨ OpenBMC VM

2. æŸ¥çœ‹ DBus state service 
-  busctl list | grep xyz.openbmc_project.State

âœ… Result 
root@qemuarm:~# busctl list | grep xyz.openbmc_project.State

:1.21                                                  260 phosphor-chassi root             :1.21         xyz.openbmc_project.State.Chassis@0.service         -       -
:1.48                                                  316 phosphor-bmc-st root             :1.48         xyz.openbmc_project.State.BMC.service               -       -
:1.50                                                  323 phosphor-host-s root             :1.50         xyz.openbmc_project.State.Host@0.service            -       -
xyz.openbmc_project.State.BMC                          316 phosphor-bmc-st root             :1.48         xyz.openbmc_project.State.BMC.service               -       -
xyz.openbmc_project.State.Chassis                      260 phosphor-chassi root             :1.21         xyz.openbmc_project.State.Chassis@0.service         -       -
xyz.openbmc_project.State.Chassis0                     260 phosphor-chassi root             :1.21         xyz.openbmc_project.State.Chassis@0.service         -       -
xyz.openbmc_project.State.Host                         323 phosphor-host-s root             :1.50         xyz.openbmc_project.State.Host@0.service            -       -
xyz.openbmc_project.State.Host0                        323 phosphor-host-s root             :1.50         xyz.openbmc_project.State.Host@0.service 

3. æŸ¥çœ‹ HOST service çš„ç‰©ä»¶æ¨¹èˆ‡ä»‹é¢
 - busctl tree xyz.openbmc_project.State.Host

âœ… Result
root@qemuarm:~# busctl tree xyz.openbmc_project.State.Host

`- /xyz
  `- /xyz/openbmc_project
    `- /xyz/openbmc_project/state
      `- /xyz/openbmc_project/state/host0

  - busctl introspect xyz.openbmc_project.State.Host /xyz/openbmc_project/state/host0

âœ… Result
root@qemuarm:~# busctl introspect xyz.openbmc_project.State.Host /xyz/openbmc_project/state/host0

NAME                                             TYPE      SIGNATURE RESULT/VALUE                             FLAGS
org.freedesktop.DBus.Introspectable              interface -         -                                        -
.Introspect                                      method    -         s                                        -
org.freedesktop.DBus.Peer                        interface -         -                                        -
.GetMachineId                                    method    -         s                                        -
.Ping                                            method    -         -                                        -
org.freedesktop.DBus.Properties                  interface -         -                                        -
.Get                                             method    ss        v                                        -
.GetAll                                          method    s         a{sv}                                    -
.Set                                             method    ssv       -                                        -
.PropertiesChanged                               signal    sa{sv}as  -                                        -
xyz.openbmc_project.Control.Boot.RebootAttempts  interface -         -                                        -
.AttemptsLeft                                    property  u         3                                        emits-change writable
.RetryAttempts                                   property  u         3                                        emits-change writable
xyz.openbmc_project.State.Boot.Progress          interface -         -                                        -
.BootProgress                                    property  s         "xyz.openbmc_project.State.Boot.Progr... emits-change writable
.BootProgressLastUpdate                          property  t         0                                        emits-change writable
xyz.openbmc_project.State.Host                   interface -         -                                        -
.AllowedHostTransitions                          property  as        5 "xyz.openbmc_project.State.Host.Tra... const
.CurrentHostState                                property  s         "xyz.openbmc_project.State.Host.HostS... emits-change writable
.RequestedHostTransition                         property  s         "xyz.openbmc_project.State.Host.Trans... emits-change writable
.RestartCause                                    property  s         "xyz.openbmc_project.State.Host.Resta... emits-change writable
xyz.openbmc_project.State.OperatingSystem.Status interface -         -                                        -
.OperatingSystemState                            property  s         "xyz.openbmc_project.State.OperatingS... emits-change writable

4. ç›£è½ HOST service çš„äº‹ä»¶
 - busctl monitor xyz.openbmc_project.State.Host

âœ… Result
root@qemuarm:~# busctl monitor xyz.openbmc_project.State.Host

Type=signal  Endian=l  Flags=1  Version=1 Cookie=6310  Timestamp="Mon 2025-09-08 07:08:39.599320 UTC"
  Sender=:1.9  Path=/xyz/openbmc_project/metric/bmc/cpu/total  Interface=org.freedesktop.DBus.Properties  Member=PropertiesChanged
  UniqueName=:1.9
  MESSAGE "sa{sv}as" {
          STRING "xyz.openbmc_project.Metric.Value";
          ARRAY "{sv}" {
                  DICT_ENTRY "sv" {
                          STRING "Value";
                          VARIANT "d" {
                                  DOUBLE 1.71569;
                          };
                  };
          };
          ARRAY "s" {
          };
  };

5. ä½¿ç”¨ obmcutil å°å·¥å…· æŸ¥çœ‹ç‹€æ…‹æœå‹™çš„ç‹€æ…‹
-  obmcutil state

âœ… Result
root@qemuarm:~# obmcutil state

CurrentBMCState     : xyz.openbmc_project.State.BMC.BMCState.Quiesced
CurrentPowerState   : xyz.openbmc_project.State.Chassis.PowerState.Off
CurrentHostState    : xyz.openbmc_project.State.Host.HostState.Off
BootProgress        : xyz.openbmc_project.State.Boot.Progress.ProgressStages.UnspecifiedOperatingSystemState: xyz.openbmc_project.State.OperatingSystem.Status.OSStatus.Inactive

-æŸ¥çœ‹ property // busctl get-property <SERVICE> <OBJECT_PATH> <INTERFACE> <PROPERTY>-
6. è®€å– HOST service host0ç‰©ä»¶çš„ CurrentHostState çš„å±¬æ€§
-  busctl get-property xyz.openbmc_project.State.Host \
  /xyz/openbmc_project/state/host0 \
  xyz.openbmc_project.State.Host CurrentHostState

âœ… Result
root@qemuarm:~# busctl get-property xyz.openbmc_project.State.Host \ /xyz/openbmc_project/state/host0 \ xyz.openbmc_project.State.Host \ CurrentHostState

s "xyz.openbmc_project.State.Host.HostState.Off"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------



======================================================================================================================================================================================
ğŸ¯ ç›®æ¨™
 åœ¨ QEMU ä¸Šå•Ÿå‹• OpenBMCï¼Œä¸¦é€é DBus å·¥å…· (busctl) æŸ¥è©¢æœ‰å“ªäº› LOG Serviceã€‚

1. æŸ¥çœ‹ DBus Log æœå‹™
root@qemuarm:~# busctl list | grep xyz.openbmc_project.Logging

2. æŸ¥çœ‹ DBus Log service ç‰©ä»¶æ¨¹
busctl tree xyz.openbmc_project.Logging

----------------------------------------------------------------
âœ… Result
1.

:1.13                                                   223 phosphor-log-ma root             :1.13         xyz.openbmc_project.Logging.service                 -       -
xyz.openbmc_project.Logging                             223 phosphor-log-ma root             :1.13         xyz.openbmc_project.Logging.service                 -       -

------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2.

root@qemuarm:~# busctl tree xyz.openbmc_project.Logging
`- /xyz
  `- /xyz/openbmc_project
    `- /xyz/openbmc_project/logging
      |- /xyz/openbmc_project/logging/entry
      | |- /xyz/openbmc_project/logging/entry/1
      | |- /xyz/openbmc_project/logging/entry/10
      | |- /xyz/openbmc_project/logging/entry/2
      | |- /xyz/openbmc_project/logging/entry/3
      | |- /xyz/openbmc_project/logging/entry/4
      | |- /xyz/openbmc_project/logging/entry/5
      | |- /xyz/openbmc_project/logging/entry/6
      | |- /xyz/openbmc_project/logging/entry/7
      | |- /xyz/openbmc_project/logging/entry/8
      | `- /xyz/openbmc_project/logging/entry/9
      `- /xyz/openbmc_project/logging/internal
        `- /xyz/openbmc_project/logging/internal/manager

---------------------------------------------------------------


