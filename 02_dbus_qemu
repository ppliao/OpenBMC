## OpenBMC DBus on QEMU å¯¦é©—ç´€éŒ„

ğŸ¯ ç›®æ¨™
  åœ¨ QEMU ä¸Šå•Ÿå‹• OpenBMCï¼Œä¸¦é€é DBus å·¥å…· (busctl) å­¸ç¿’æŸ¥è©¢ã€ç›£è½èˆ‡æ“ä½œç³»çµ±ç‹€æ…‹ã€‚

ğŸŒ¸ ç’°å¢ƒ
  Host: Ubuntu 20.04 / WSL2
  QEMU target: qemuarm
  Image: obmc-phosphor-image
  Networking: slirp (host port forwarding)
  Tool: busctl, obmcutil, ssh

ğŸ”‘ æ­¥é©Ÿ
1. SSH é€²å…¥ Guest(BMC)
  ssh -p 2222 root@127.0.0.1
  cat /etc/os-release   # ç¢ºèªæ˜¯åœ¨ OpenBMC VM

2. æŸ¥çœ‹ DBus æœå‹™
  busctl list | grep xyz.openbmc_project.State

3. æŸ¥çœ‹ç‰©ä»¶æ¨¹èˆ‡ä»‹é¢
  busctl tree xyz.openbmc_project.State.Host
  busctl introspect xyz.openbmc_project.State.Host /xyz/openbmc_project/state/host0

4. ç›£è½äº‹ä»¶
  busctl monitor xyz.openbmc_project.State.Host

5. è§¸ç™¼ç‹€æ…‹è®ŠåŒ–
  obmcutil poweron
  obmcutil powerstate

6. è®€å–å±¬æ€§
  busctl get-property xyz.openbmc_project.State.Host \
  /xyz/openbmc_project/state/host0 \
  xyz.openbmc_project.State.Host CurrentHostState

âœ… Result
1.  root@qemuarm:~# busctl list | grep xyz.openbmc_project.State

:1.21                                                  260 phosphor-chassi root             :1.21         xyz.openbmc_project.State.Chassis@0.service         -       -
:1.48                                                  316 phosphor-bmc-st root             :1.48         xyz.openbmc_project.State.BMC.service               -       -
:1.50                                                  323 phosphor-host-s root             :1.50         xyz.openbmc_project.State.Host@0.service            -       -
xyz.openbmc_project.State.BMC                          316 phosphor-bmc-st root             :1.48         xyz.openbmc_project.State.BMC.service               -       -
xyz.openbmc_project.State.Chassis                      260 phosphor-chassi root             :1.21         xyz.openbmc_project.State.Chassis@0.service         -       -
xyz.openbmc_project.State.Chassis0                     260 phosphor-chassi root             :1.21         xyz.openbmc_project.State.Chassis@0.service         -       -
xyz.openbmc_project.State.Host                         323 phosphor-host-s root             :1.50         xyz.openbmc_project.State.Host@0.service            -       -
xyz.openbmc_project.State.Host0                        323 phosphor-host-s root             :1.50         xyz.openbmc_project.State.Host@0.service 

--------------------------------------------------------------------------------------------------------------
2.  root@qemuarm:~# busctl tree xyz.openbmc_project.State.Host

`- /xyz
  `- /xyz/openbmc_project
    `- /xyz/openbmc_project/state
      `- /xyz/openbmc_project/state/host0

-------------------------------------------------------------------------------------------------------------
3.  root@qemuarm:~# busctl introspect xyz.openbmc_project.State.Host /xyz/openbmc_project/state/host0

NAME                                             TYPE      SIGNATURE RESULT/VALUE                             FLAGS
org.freedesktop.DBus.Introspectable              interface -         -                                        -
.Introspect                                      method    -         s                                        -
org.freedesktop.DBus.Peer                        interface -         -                                        -
.GetMachineId                                    method    -         s                                        -
.Ping                                            method    -         -                                        -
org.freedesktop.DBus.Properties                  interface -         -                                        -
.Get                                             method    ss        v                                        -
.GetAll                                          method    s         a{sv}                                    -
.Set                                             method    ssv       -                                        -
.PropertiesChanged                               signal    sa{sv}as  -                                        -
xyz.openbmc_project.Control.Boot.RebootAttempts  interface -         -                                        -
.AttemptsLeft                                    property  u         3                                        emits-change writable
.RetryAttempts                                   property  u         3                                        emits-change writable
xyz.openbmc_project.State.Boot.Progress          interface -         -                                        -
.BootProgress                                    property  s         "xyz.openbmc_project.State.Boot.Progr... emits-change writable
.BootProgressLastUpdate                          property  t         0                                        emits-change writable
xyz.openbmc_project.State.Host                   interface -         -                                        -
.AllowedHostTransitions                          property  as        5 "xyz.openbmc_project.State.Host.Tra... const
.CurrentHostState                                property  s         "xyz.openbmc_project.State.Host.HostS... emits-change writable
.RequestedHostTransition                         property  s         "xyz.openbmc_project.State.Host.Trans... emits-change writable
.RestartCause                                    property  s         "xyz.openbmc_project.State.Host.Resta... emits-change writable
xyz.openbmc_project.State.OperatingSystem.Status interface -         -                                        -
.OperatingSystemState                            property  s         "xyz.openbmc_project.State.OperatingS... emits-change writable

----------------------------------------------------------------------------------------------------------
4.  busctl monitor xyz.openbmc_project.State.Host

Type=signal  Endian=l  Flags=1  Version=1 Cookie=6310  Timestamp="Mon 2025-09-08 07:08:39.599320 UTC"
  Sender=:1.9  Path=/xyz/openbmc_project/metric/bmc/cpu/total  Interface=org.freedesktop.DBus.Properties  Member=PropertiesChanged
  UniqueName=:1.9
  MESSAGE "sa{sv}as" {
          STRING "xyz.openbmc_project.Metric.Value";
          ARRAY "{sv}" {
                  DICT_ENTRY "sv" {
                          STRING "Value";
                          VARIANT "d" {
                                  DOUBLE 1.71569;
                          };
                  };
          };
          ARRAY "s" {
          };
  };

----------------------------------------------------------------------------------------------------

ğŸ¯ ç›®æ¨™
åœ¨ QEMU ä¸Šå•Ÿå‹• OpenBMCï¼Œä¸¦é€é Redfish API èˆ‡ DBus æ“ä½œæ—¥èªŒ (LogService)ï¼Œé©—è­‰å…©è€…é—œè¯ã€‚

ğŸ”‘ æ­¥é©Ÿ
1. è§¸ç™¼ä¸€ç­†æ—¥èªŒ
ï¼ˆHost ä¸Šæ•…æ„æ‰“éŒ¯å¯†ç¢¼ï¼Œè®“ bmcweb è¨˜ä¸€ç­†ç™»å…¥å¤±æ•—ï¼‰ï¼š
curl -k -u root:WRONGPASS https://localhost:2443/redfish/v1/Systems -o /dev/null

