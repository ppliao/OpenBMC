## OpenBMC Redfish â†” DBus å¯¦ä½œè¨˜éŒ„

ğŸ“ ç›®æ¨™
1. é€é Redfish èˆ‡ DBus é©—è­‰ PowerState å°ç…§

ğŸŒ¸ ç’°å¢ƒ
  Hostï¼šUbuntu 20.04 / WSL2
  QEMU targetï¼šqemuarm
  Imageï¼šobmc-phosphor-image
  Toolsï¼šcurlã€jqã€busctlã€journalctlã€ssh

ğŸ”‘ æ­¥é©Ÿ
1. SSH é€²å…¥ Guest(BMC)
  ssh -p 2222 root@127.0.0.1

2. Redfish æŸ¥é›»æºç‹€æ…‹
  curl -k -u root:0penBmc \                            //-k Ignore SSL certificate verification //-u root:openbmc ä½¿ç”¨ HTTP Basic Auth ç™»å…¥ 
  https://localhost:2443/redfish/v1/Systems/system \  //æŒ‡å®š BMC çš„ Redfish ä¼ºæœå™¨åŸ 
| jq '.PowerState'

3. DBus æŸ¥é›»æºç‹€æ…‹
  busctl get-property xyz.openbmc_project.State.Chassis \
  /xyz/openbmc_project/state/chassis0 \
  xyz.openbmc_project.State.Chassis CurrentPowerState

âœ… Result
tzuyi@PHT-BB19964-NB:~/open/openbmc$ curl -k -u root:0penBmc https://localhost:2443/redfish/v1/Systems/system | jq '.PowerState'
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  2487  100  2487    0     0   5245      0 --:--:-- --:--:-- --:--:--  5235
"Off"

root@qemuarm:~# busctl get-property xyz.openbmc_project.State.Chassis \
>   /xyz/openbmc_project/state/chassis0 \
>   xyz.openbmc_project.State.Chassis CurrentPowerState
s "xyz.openbmc_project.State.Chassis.PowerState.Off"

-----------------------------------------------------------------------------

ğŸ“ ç›®æ¨™
1. è®€å–ä¸¦æ¸…ç©º BMC çš„ EventLog / Journalï¼Œç†è§£ Redfish èˆ‡ DBus/ç³»çµ±å·¥å…·çš„åˆ†å·¥

ğŸ”‘ æ­¥é©Ÿ
1. Redfish è®€å– Journal/Entries ç¸½æ•¸
  curl -k -u root:0penBmc \
  https://localhost:2443/redfish/v1/Managers/bmc/LogServices/Journal/Entries \
  | jq '.Members | length'

2. ç”¨ DBus æ¸…ç©ºï¼ˆä¸€å®šå¯è¡Œï¼‰
  busctl call xyz.openbmc_project.Logging \
  /xyz/openbmc_project/logging \
  xyz.openbmc_project.Collection.DeleteAll DeleteAll

3. é©—è­‰
  curl -k -u root:0penBmc \
  https://localhost:2443/redfish/v1/Managers/bmc/LogServices/Journal/Entries \
  | jq '.Members | length'

âœ… Result
  tzuyi@PHT-BB19964-NB:/mnt/c/Users/User$ curl -k -u root:0penBmc https://localhost:2443/redfish/v1/Managers/bmc/LogServices/EventLog/Entries \
  | jq '.Members | length'
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  100   577  100   577    0     0   1420      0 --:--:-- --:--:-- --:--:--  1417
  0

------------------------------------------------------------------------------------
